<% content_for :title do %>
	<%= @student.name %> | CodingDojo's Network Library
<% end %>

<% content_for :jquery do %>
    <script>
        jQuery.ajaxSetup({
            'beforeSend': function(xhr) {xhr.setRequestHeader("Accept", "text/javascript")}
        })

        $(document).ready(function(){

            $('#profile_tab a').click(function (e) {
                e.preventDefault();
                $(this).tab('show');
            });

            <% if is_recruiter? %>
                status = 1;

                $("a").click(function(e){
                    var location = $(this).attr('href')
                    if(location == '/students' || location == '/signout'){
                        e.preventDefault();
                        status = 1
                        window.location.href = location;
                    }
                });
                $(window).keydown(function(e){
                    if (e.keyCode == 116){
                       status = 0
                    }
                })

                $(window).bind('beforeunload', function (e) {

                    $.ajax({
                        url: '<%= recruiter_view_path(@recruiter_view, 0) %>'+status,
                        type: 'PUT',
                        data: '&action=update_recruiter_view',
                        success: function(data) {
                        },
                        async : false
                    });
                });

                $('div.item').children("li").mouseenter(function(){ $(this).find("p.trigger_tooltip").tooltip('show'); }).mouseout(function(){ $(this).find("p.trigger_tooltip").tooltip('hide'); });

                

                $("a.get_introduce").click(function(e){
                    e.preventDefault();
                    $.post(this.getAttribute('data-link'), null, "script")
                });

                $("a.add_to_short_list").click(function(e){
                    e.preventDefault();
                    $.post(this.getAttribute('data-link'), null, "script")
                });

                $("a.remove_from_short_list").click(function(e){
                    e.preventDefault();
                    $.post(this.getAttribute('data-link'), null, "script");
                
                });

                 <% if current_user.candidate_list.length > 0 and current_user.candidate_list.length < 5 %>
                    $("a.carousel-control").hide();
                 <% end %>
            <% end %>
        });
    </script>
<% end %>

<div class="student_profile">
    <div class="main_profile">
        <p><a href="<%= students_path %>">Dashboard</a> > <%= @student.name %></p>
        <img id="main_photo" class="main-photo" src="<%= @profile.image_src.nil? || @profile.image_src == "" ? @profile.avatar.url(:medium) : @profile.image_src %>" />
        <div class="student_info">
            <h1><%= @student.name %></h1>
            <h2><%= @student.location %></h2>
            <% if @profile.resume_url != nil and @profile.resume_url != "" %>
            <p><a href="<%= @profile.resume_url %>" target="_blank"><%= @student.name + "'s resume" %></a></p>
            <% end %>

            <% if is_admin? %>
            <p><a href="/students/<%= @student.id %>/edit" class="btn btn-primary">Edit Info</a></p>
             <% elsif is_recruiter? %>
                <div class='recruiter_controls'>
                    <p class='pull-left'><a href="#modal" class='get_introduce btn btn-primary' data-link='<%= send_email_to_student_path(@student.id) %>' data-action='get_introduces'>Get Introduce</a></p>
                    <% if @student.recruiter_lists.where(:id => current_user.id).length == 0 %>
                        <p class='pull-left'><a class='add_to_short_list btn btn-primary' data-link='<%= add_to_short_list_path(@student.id) %>'>Save to a short list</a></p>
                    <% else  %>
                        <p class='pull-left'><a class='remove_from_short_list btn btn-primary' data-link='<%= remove_from_short_list_path(@student.id) %>'>Remove from short list</a></p>
                    <% end %>
                    <div class='clear'></div>
                </div>
                <% if current_user.candidate_list.length > 0 %>
                     <div id='candidates' class='recruiter_candidates carousel slide'>
                        <ol class="carousel-indicators">
                            <% for count in 0..(current_user.candidate_list.length / 5).round %>
                                <li data-target="#candidates" data-slide-to="<%=count%>" class="<%= count == 0 ? 'active' : '' %>"></li>
                            <% end %>
                        </ol>
                        <ul class='carousel-inner recruiter_candidate_lists'>
                        <% 
                        count = 1
                        current_user.candidate_list.each do |student| 

                            if count > 5 
                                count = 1
                        %>                   
                                </div><div class='clear'></div><div class='item pull-left'>
                        <% elsif count == 1%>
                                <div class='item active'>
                        <% end %>

                                    <li class='<%= student.id == @student.id ? "active " : "" %>'  title='<%= student.name %>'>
                                        <a href="<% if student.id != @student.id %>/students/<%= student.id %> <% else %> # <% end %>">
                                            <img src="<%= student.student_profile.image_src.nil? || student.student_profile.image_src == "" ? student.student_profile.avatar.url(:thumb) : student.student_profile.image_src  %>" alt="<%= student.name %>">
                                            <p><%= truncate(student.name, :length => 16) %></p>
                                        </a>
                                    </li>
                        <%  count = count + 1;
                        end 
                        %>
                                </div>
                                <div class='clear'></div>
                        </ul>
                        <a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
                        <a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
                    </div>
                <% end %>
            <% end %>
        </div>
    </div>
    <div class='profile_information'>
        <ul class="nav nav-tabs" id="profile_tab">
            <li class="active"><a href="#overview">Overview</a></li>
            <li><a href="#resume">Resume</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane active" id="overview">
                <div class="certified">
                    <ul class="video-list">
                        <% if @profile.video_url != nil %>
                        <li>
                        <iframe class="profile-video" src="<%= @profile.video_url %>" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe><p>Video introduction</p>
                        </li>
                        <% end %>
                        <% if @profile.project1_name != nil %>
                        <li>
                        <iframe class="profile-video" src="<%= @profile.project1_url %>" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe><p><%= @profile.project1_name %></p>
                        </li>
                        <% end %>
                        <% if @profile.project2_name != nil %>
                        <li>
                        <iframe class="profile-video" src="<%= @profile.project2_url %>" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe><p><%= @profile.project2_name %></p>
                        </li>
                        <% end %>
                        <% if @profile.project3_name != nil %>
                        <li>
                        <iframe title="Project1" class="profile-video" src="<%= @profile.project3_url %>" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe><p><%= @profile.project3_name %></p>
                        </li>
                        <% end %>
                    </ul>
                    <h3 class="title">Certified Topics</h3>
                    <div class="belt-scores <%= "no-score" if @profile.yellow_belt_score.nil? %>">
                        <div class="competencies">
                            <h3 class="belt-title">Yellow Belt</h3>
                            <ul>
                                <li>HTML</li>
                                <li>CSS</li>
                                <li>jQuery/Javascript</li>
                            </ul>
                        </div>
                        <div class="yellow-belt"><h3 class="score"><%= @profile.yellow_belt_score %>&nbsp;</h3></div>
                    </div>
                    <div class="belt-scores <%= "no-score" if @profile.green_belt_score.nil? %>">
                        <div class="competencies">
                            <h3 class="belt-title">Green Belt</h3>
                            <ul>
                                <li>PHP</li>
                                <li>MySQL/Database Design</li>
                                <li>Agile</li>
                            </ul>
                        </div>
                        <div class="green-belt"><h3 class="score"><%= @profile.green_belt_score %>&nbsp;</h3></div>
                    </div>
                    <div class="belt-scores <%= "no-score" if @profile.red_belt_score.nil? %>">
                        <div class="competencies">
                            <h3 class="belt-title">Red Belt</h3>
                            <ul>
                             <li>OOP</li>
                                <li>Git/SVN</li>
                                <li>Ruby</li>
                                <li>Ajax</li>
                            </ul>
                        </div>
                        <div class="red-belt"><h3 class="score"><%= @profile.red_belt_score %>&nbsp;</h3></div>
                    </div>
                    <div class="belt-scores <%= "no-score" if @profile.black_belt_score.nil? %>">
                        <div class="competencies">
                            <h3 class="belt-title">Black Belt</h3>
                            <ul>
                                <li>Ruby on Rails</li>
                                <li>CodeIgniter</li>
                                <li>Linux and Cloud</li>
                            </ul>
                        </div>
                        <div class="black-belt"><h3 class="score"><%= @profile.black_belt_score %>&nbsp;</h3></div>
                    </div>
                 </div><!-- end certified -->
            </div>
            <div class="tab-pane" id="resume">
                <div class='resume'>
                    <% if !@profile.resume_url.nil? %>
                        <embed class='view_resume' src='<%= @profile.resume_url %>'></embed>
                    <% elsif !@profile.resume.url.nil? %>
                        <embed class='view_resume' src='<%= @profile.resume.url %>'></embed>
                    <% end %>
                </div>
            </div>
        </div>
    </div>
</div> <!-- end of student profile -->

<!-- CREATE MODAL -->
<div id='modal' class="modal hide fade">
  <div class="modal-footer"></div>
</div>